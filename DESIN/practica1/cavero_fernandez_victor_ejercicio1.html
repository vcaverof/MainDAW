<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        const usuarios = new Set();

        function añadirUsuario() {
            let entrada = prompt("Introduce tu nombre completo (nombre y dos apellidos)");
            let partes = entrada.trim().split(" ");

            if (partes.length < 3) {
                alert("Introduce el nombre de forma correcta");
                return;
            }

            let nombre = partes[0];
            let ap1 = partes[1];
            let ap2 = partes[2];
            let nombreCompleto = nombre + " " + ap1 + " " + ap2;

            //Comprobar si existe el usuario
            for (let usuario of usuarios) {
                if (usuario.nombre === nombreCompleto) {
                    alert("El usuario ya existe");
                    return;
                }
            }

            //Mostrar la info del nombre
            let sinEspacios = partes.join("");
            alert("Tamaño sin espacios: " + sinEspacios.length);
            alert("Minúsculas: " + nombreCompleto.toLowerCase());
            alert("Mayúsculas: " + nombreCompleto.toUpperCase());
            alert(`Nombre: ${nombre}\nApellido 1: ${ap1}\nApellido 2: ${ap2}`);


            //Elegir tipo de contraseña
            let tipo = prompt("Elige tipo de contraseña:\n1. nombre + iniciales apellidos\n2. 2 letras de cada\n3. letra + posición");
            let password;

            switch (tipo) {
                case "1":
                    password = nombre.toLowerCase() + ap1[0].toUpperCase() + ap2[0].toUpperCase();
                    break;
                case "2":
                    password = nombre.slice(0, 2).toUpperCase() + ap1.slice(0, 2).toLowerCase() + ap2.slice(0, 2).toLowerCase();
                    break;
                case "3":
                    password = nombre.split("").map((l, i) => l + i).join("");
                    break;
                default:
                    password = "clave123";
            }

            //Añadir usuario a la colección
            usuarios.add({ nombre: nombreCompleto, contraseña: password });
            alert("Usuario añadido con contraseña: " + password);
        }

        function modificarUsario() {
            let nombreBuscado = prompt("Nombre completo: ");
            let passwordActual = prompt("Contraseña: ")

            let encontrado = false;

            for (let usuario of usuarios) {
                if (usuario.nombre === nombreBuscado && usuario.contraseña === passwordActual) {
                    let nuevaPassword = prompt("Introduce la nueva contraseña: ");
                    //Eliminar usuario antiguo
                    usuarios.delete(usuario);
                    //Añadir el usuario con la nueva contraseña
                    usuarios.add({ nombre: nombreBuscado, contraseña: nuevaPassword });
                    encontrado = true;
                    break;
                }

                if (!encontrado) {
                    alert("Usuario no encontrado o contraseña incorrecta");
                }
            }
        }

        function eliminarUsuario() {
            let nombreBuscado = prompt("Nombre completo: ");
            let encontrado = false;

            for (let usuario of usuarios) {
                 if (usuario.nombre === nombreBuscado) {
                    //Eliminar usuario antiguo
                    usuarios.delete(usuario);
                    alert("Usuario eliminado con éxito");
                    encontrado = true;
                    break;
                }

                if (!encontrado) {
                    alert("Usuario no encontrado o contraseña incorrecta");
                }
            }
        }

        function menu() {

            let salir = false;

            while (!salir) {
                let opcion = prompt("Selecciona una opcion: \n1. Añadir usuario\n2. Modificar usuario\n3. Eliminar usuario\n4. Mostrar usuarios\n5. Salir");
                switch (opcion) {
                    case "1":
                        añadirUsuario();
                        break;
                    case "2":
                        modificarUsario();
                        break;
                    case"3":
                        eliminarUsuario();
                        break;
                    case "4":
                        let salida = "Usuarios registrados:\n";
                        for (let usuario of usuarios) {
                            salida += `${usuario.nombre} → ${usuario.contraseña}\n`;
                        }
                        alert(salida);
                        break;
                    case "5":
                        salir = true;
                        break;
                    default:
                        alert("Opción no válida");
                }
            }
        }

        menu();
    </script>
</body>

</html>