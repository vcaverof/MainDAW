<script src="https://cdn.tailwindcss.com"></script>
<script src="./js/main.js"></script>


<div class="bg-gray-50 text-gray-800">

    <!-- NAVBAR -->
    <div id="navbar"></div>

    <div class="max-w-5xl mx-auto mt-10 px-6">

        <!-- CREAR EVENTO -->
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 mb-10">
            <h2 class="text-2xl font-semibold mb-6">Crear nuevo evento</h2>

            <form onsubmit="crearEvento(event)" class="space-y-4">

                <input type="text" id="nombre" placeholder="Nombre"
                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-green-300 focus:outline-none"
                    required>

                <textarea id="descripcion" placeholder="Descripción"
                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-green-300 focus:outline-none"
                    required></textarea>

                <input type="date" id="fecha"
                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-green-300 focus:outline-none"
                    required>

                <div>
                    <label class="font-medium">Municipio:</label>
                    <select id="municipio"
                        class="w-full border border-gray-300 rounded-md px-3 py-2 mt-1 bg-white focus:ring-2 focus:ring-green-300 focus:outline-none">
                    </select>
                </div>

                <button type="submit" class="px-4 py-2 bg-green-200 hover:bg-green-300 rounded-md transition">
                    Crear evento
                </button>
            </form>
        </div>

        <!-- LISTA DE EVENTOS -->
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <h2 class="text-2xl font-semibold mb-6">Eventos existentes</h2>

            <div id="lista" class="space-y-6"></div>
        </div>

    </div>

    <!-- CARGA DEL NAVBAR -->
    <script>
        cargarNavbar();
    </script>

    <script src="js/api.js"></script>

    <script>
        function requireAdmin() {
            const user = JSON.parse(localStorage.getItem("user"));
            if (!user || user.rol_id !== 1) {
                alert("No tienes permisos para acceder aquí");
                window.location.href = "eventos.html";
            }
        }

        async function cargarMunicipios() {
            const municipios = await apiGet("/municipios");
            const select = document.getElementById("municipio");

            municipios.forEach(m => {
                select.innerHTML += `<option value="${m.id}">${m.nombre}</option>`;
            });
        }

        async function cargarEventos() {
            const eventos = await apiGet("/eventos");
            const contenedor = document.getElementById("lista");
            contenedor.innerHTML = "";

            eventos.forEach(e => {
                contenedor.innerHTML += `
                <div class="border border-gray-200 rounded-lg p-5 shadow-sm bg-white">
                    <h3 class="text-lg font-semibold mb-2">${e.nombre}</h3>
                    <p class="text-gray-700 mb-2">${e.descripcion}</p>
                    <p class="text-gray-600"><strong>Fecha:</strong> ${e.fecha}</p>
                    <p class="text-gray-600 mb-4"><strong>Municipio:</strong> ${e.municipio.nombre}</p>

                    <div class="flex gap-3">
                        <button onclick="editar(${e.id})"
                            class="px-4 py-2 bg-green-200 hover:bg-green-300 rounded-md transition">
                            Editar
                        </button>

                        <button onclick="eliminar(${e.id})"
                            class="px-4 py-2 bg-red-200 hover:bg-red-300 rounded-md transition">
                            Eliminar
                        </button>
                    </div>
                </div>
                `;
            });
        }

        async function crearEvento(ev) {
            ev.preventDefault();

            const data = {
                nombre: document.getElementById("nombre").value,
                descripcion: document.getElementById("descripcion").value,
                fecha: document.getElementById("fecha").value,
                municipio_id: document.getElementById("municipio").value
            };

            await apiPost("/eventos", data);
            alert("Evento creado");
            cargarEventos();
        }

        async function eliminar(id) {
            if (!confirm("¿Seguro que quieres eliminar este evento?")) return;

            await apiDelete(`/eventos/${id}`);
            cargarEventos();
        }

        function editar(id) {
            window.location.href = `editar-evento.html?id=${id}`;
        }

        async function logout() {
            await apiPost("/logout");
            localStorage.clear();
            window.location.href = "login.html";
        }

        async function iniciar() {
            requireAdmin();
            await cargarMunicipios();
            await cargarEventos();
        }

        iniciar();
    </script>

</div>